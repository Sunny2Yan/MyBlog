# 用户身份与文件权限

## 1. 用户身份
用户身份号码UID（User IDentification）:

- 管理员UID：0
- 系统用户UID：1-999
- 普通用户UID：1000-

用户组号码GID（Group IDentification）：用户组
```bash
id 用户名              # 查看用户信息
useradd [参数] 用户名  # 创建新的用户账户
    -d  # 指定用户的家目录
    -e  # 用户到期时间 YYYY-MM-DD
    -u  # 指定用户UID
    -g  # 指定一个初始的用户基本组
    -G  # 指定一个或多个扩展组
    -N  # 不创建同名用户
    -s  # 指定用户的默认shell解释器
groupadd [参数] 组名    # 创建新的用户组
usermod [参数] 用户名   # 修改用户属性，user modify
    -c  # 填写备注
    -d -m  # 指定用户的家目录，并把旧数据迁移过去
    -e  # 用户到期时间，YYYY-MM-DD
    -g  # 变更所属用户组
    -G  # 变更拓展用户组
    -L  # 锁定用户禁止登陆系统
    -U  # 解锁用户允许登录系统
    -u  # 修改用户UID
passwd [参数] 用户名    # 修改用户密码，过期时间等
    -l  # 锁定用户，禁止登陆
    -u  # 解锁用户，允许登录
    -d  # 可以使用空密码登录
    -e  # 强制用户下次登陆时修改密码
    -S  # 显示密码是否被锁定
userdel [参数] 用户名   # 删除已有的用户账户，user delete
    -f  # 强制删除
    -r  # 同时删除用户和用户家目录
```

## 2. 用户权限
| 权限项   | 可读 |  可写  | 可执行 | 可读 |  可写  | 可执行 | 可读 |   可写   | 可执行 |
| :------- | :--: | :----: | :----: | :--: | :----: | :----: | :--: | :------: | :----: |
| 字符     |  r   |   w    |   x    |  r   |   w    |   x    |  r   |    w     |   x    |
| 数字     |  4   |   2    |   1    |  4   |   2    |   1    |  4   |    2     |   1    |
| 权限分配 |      | 所有者 |        |      | 所属组 |        |      | 其他用户 |        |

```bash
eg: ls -l xxx
    >> -rw-r--r-- 1 root root xxx
    -: 文件类型（-普通文件；-d目录文件；l链接文件；p管道文件；b块设备文件；c字符设备文件）
    rw-r--r--: 访问权限
    root: 属主
    root: 属组

# 修改权限
chmod 777 file       # 修改访问权限，change mode
    -R  # 递归操作
chown new_user file  # 更改某个文件或目录的所属者，change owner
    -R  # 递归操作
chgrp new_user file  # 修改所属组权限，change group
```

## 3. 文件特殊权限

- SUID：对二进制程序进行设置的特殊权限；`rwS`
- SGID：临时获得二进制程序文件所属组权限；`rws`
- SBIT：用户只能删除自己的文件；`rwt`

## 4. 文件隐藏属性
```bash
chattr [+参数/-参数] 文件名  # 设置文件隐藏权限，change attributes
    +参数：添加功能；-参数：移除功能
    i  # 无法对文件进行修改
    a  # 仅允许追加内容
    s  # 彻底从硬盘删除，不可恢复
    u  # 删除文件后依然保存在硬盘中
    x  # 可以直接访问压缩文件中的内容

lsattr [参数] 文件名  # 查看文件的隐藏权限
```

## 5. 文件访问控制列表（ACL）

对指定用户进行单独的权限控制。`-rwxr--r--+` +表示已设置ACL权限。

```bash
setfacl [参数] 文件名称  # 管理文件的ACL权限规则，set files ACL
    -m  # 修改权限
    -M  # 从文件中读取权限
    -x  # 删除某个权限
    -b  # 删除全部权限
    -R  # 递归子目录

getfacl [参数] 文件名    # 查看文件的ACL权限规则，get files ACL
```

## 6. su 和 sudo
```bash
su - root  # 切换root身份，-表示环境变量也切换到新的身份

sudo [参数] 用户名  # 给普通用户提供额外的权限
    -h  # -help
    -l  # 列出当前用户可执行的命令
    -u  # 以指定的用户身份执行命令，UID
    -k  # 清空密码的有效时间
    -b  # 在后台执行指定的命令
    -p  # 更改询问密码的提示语
```
